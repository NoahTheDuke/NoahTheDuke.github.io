<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <title>Thoughts and bits: Forgot about this draft post</title>
        
<meta name="keywords" content="clojure,jinteki.net,oops i forgot about this draft,cohost mirror,devblog">

<meta name="description" content="I wrote this draft months ago right before bed, planning on coming back to it in the morning. Now I don’t remember what my breakthrough was. Damn. The description below of jnet’s problems is well worth reading if you give a shit, but never resolves lol.Original post:I’ve had a breakthrough about jinyeki.net’s engine">

<meta property="og:description" content="I wrote this draft months ago right before bed, planning on coming back to it in the morning. Now I don’t remember what my breakthrough was. Damn. The description below of jnet’s problems is well worth reading if you give a shit, but never resolves lol.Original post:I’ve had a breakthrough about jinyeki.net’s engine">

<meta property="og:url" content="https://noahtheduke.github.io/posts/cohost-mirror/2023-12-04-forgot-about-this-dr/" />
<meta property="og:title" content="Forgot about this draft post" />
<meta property="og:type" content="article" />

        <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">

        <link href="https://fonts.googleapis.com/css?family=Montserrat:400,700|Oxygen:300,400,700|Inconsolata" rel="stylesheet">
        <link href="/css/normalize.css" rel="stylesheet" type="text/css" />
        <link href="/css/blog.css" rel="stylesheet" type="text/css" />
        <link href="/css/colors/colorful.css" rel="stylesheet" type="text/css" />
    </head>
    <body>
        <aside id="sidebar">
            <div id="logo">
                <a title="Thoughts and bits" href="/">
                    <img class="icon" src="/img/profile.webp">
                    <div class="text desktop-and-tablet-only">Thoughts and bits</div>
                    <div class="text mobile-only">Thoughts and bits</div>
                </a>
            </div>

            <nav id="sidebar-links">
                <nav id="menucont">
                    <input type="checkbox" id="menu-checkbox" class="menu-checkbox">
                    <label for="menu-checkbox" class="menutitle">
                        <svg class="icon icon-menu" aria-hidden="true"><use xlink:href="/img/icons.svg#icon-menu"></use></svg><span class="menu-text">Menu</span>
                    </label>
                    <ul class="menu">
                        <li >
                            <a title="Home" href="/">
                                <div class="menu-item-text">Home</div>
                            </a>
                        </li>
                        
                        <li >
                            <a title="Posts" href="/p/1/">
                                <div class=" menu-item-text">Posts</div>
                            </a>
                        </li>
                        <li >
                            <a href="/about/">
                                <div class="menu-item-text">About</div>
                            </a>
                        </li>
                        
                        <li >
                            <a title="Archives" href="/archives/">
                                <div class="menu-item-text">Archives</div>
                            </a>
                        </li>
                        
                        <li >
                            <a title="Tags" href="/tags/">
                                <div class="menu-item-text">Tags</div>
                            </a>
                        </li>
                        
                    </ul>
                </nav>

                <nav id="socialmedia">
                    <ul>
                        <li><a title="LinkedIn" href="https://www.linkedin.com/in/noah-bogart" rel="external"><svg class="icon icon-linkedin"><use xlink:href="/img/icons.svg#icon-linkedin"></use></svg></a></li>
                        <li><a title="GitHub" href="https://github.com/NoahTheDuke" rel="external"><svg class="icon icon-github-circled"><use xlink:href="/img/icons.svg#icon-github-circled"></use></svg></a></li>
                        <li><a title="RSS Feed" href="/feed.xml"><svg class="icon icon-rss-squared"><use xlink:href="/img/icons.svg#icon-rss-squared"></use></svg></a></li>
                    </ul>
                </nav>
            </nav>
        </aside>

        <article id="main">
            
<div id="post">
    <div class="post-header">
    <div id="post-meta">
        <h1>Forgot about this draft post</h1>
        <div class="byline">
            Dec 4, 2023
            <span title="December 4, 2023">@204.86</span>
            / 
                
                <a href="/tags/clojure/">#clojure</a>
                
                <a href="/tags/cohost%20mirror/">#cohost mirror</a>
                
                <a href="/tags/devblog/">#devblog</a>
                
                <a href="/tags/jinteki.net/">#jinteki.net</a>
                
                <a href="/tags/oops%20i%20forgot%20about%20this%20draft/">#oops i forgot about this draft</a>
                
            
        </div>
    </div>
</div>
<div>
    
    <p>I wrote this draft months ago right before bed, planning on coming back to it in the morning. Now I don’t remember what my breakthrough was. Damn. The description below of jnet’s problems is well worth reading if you give a shit, but never resolves lol.</p><p>Original post:</p><h1 id="ive-had-a-breakthrough-about-jinyekinets-engine">I’ve had a breakthrough about jinyeki.net’s engine</h1><hr /><p>first, a description of the problems. There are many:</p><ol><li><p>We handle all instructions that could have player input with nested callbacks. We use clojure macros to make it easier, but it’s fundamentally callback hell. Means we have to manually pass the callbacks around and have to verify every single branch calls the callback at the end (or passes it along). Also means we can’t queue up multiple instructions or handle multiple callbacks in a row, we have to write recursive functions to step over them one at a time.</p></li><li><p>We have no core game loop. Instead, each input from a player calls an action, an engine function which handles everything relevant to that input. This makes our action code messy and makes it hard to propagate updates to parts of the game state that aren’t directly touched by the given action.</p></li><li><p>Additionally, we don’t update values on cards by card abilities (X gains +1 Y) immediately, we create an object that says “x gains y” and then delegate the update to a loop that recalculates <em>everything</em>, all potential updated values. This is extremely costly, so we only do it after handling the whole action. This leads to inconsistency issues and having to force recalculate parts adhoc as situations arise.</p></li><li><p>The engine is not a state machine. It says “I’m in phase X”, but it doesn’t block players or functions from doing whatever most of the time. Means we have to work around any function being callable from anywhere else with little guarantees that the game will be in the right phase.</p></li></ol>
</div>
<br/>


    
    <div id="prev-next">
    
    <a class="prev" href="/posts/cohost-mirror/2023-12-09-after-nearly-4-years/"><svg class="icon icon-circle-left"><use xlink:href="/img/icons.svg#icon-circle-left"></use></svg><div class="nav-text"></div></a>
    
    
    <a class="next" href="/posts/cohost-mirror/2023-12-03-steam-deck-thoughts/"><div class="nav-text"">Steam Deck thoughts after an hour</div><svg class="icon icon-circle-right"><use xlink:href="/img/icons.svg#icon-circle-right"></use></svg></a>
    
</div>

    

    


</div>

            <hr/>
            <div id="footercont">
                Copyright &copy; 2024 Noah Bogart
                <br>Powered by <a href="http://cryogenweb.org">Cryogen</a>
                <br>Theme by <a href="http://github.com/KingMob">KingMob</a>
            </div>
        </article>

        
        
    </body>
</html>
